<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Snake Game</title> 
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #2b2b2b;
      color: #fff;
      font-family: Arial, sans-serif;
      touch-action: none;
      overscroll-behavior: none;
    }

    #container {
      text-align: center;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    canvas {
      width: 100vmin;
      height: 100vmin;
      max-width: 100vw;
      max-height: 100vh;
      background: #1e1e1e;
      border: 4px solid #00e676;
      border-radius: 12px;
    }

    #info { margin-top: 8px; }

    #skinMenu {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }

    .skin-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 2px solid #fff;
      cursor: pointer;
    }

    .skin-btn.active {
      outline: 3px solid #ffeb3b;
    }
  </style>
</head>
<body>
  <div id="container">
    <canvas id="game" width="400" height="400"></canvas>
    <div id="info">Score: <span id="score">0</span> | Best: <span id="best">0</span></div>
    <div id="skinMenu"></div>
    <button id="startBtn">Start Game</button>
    <button id="installBtn" style="display:none; margin-top:8px;">
      Install Snake Game
    </button>

  </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreText = document.getElementById('score');
const bestText = document.getElementById('best');
const startBtn = document.getElementById('startBtn');
const skinMenu = document.getElementById('skinMenu');

const box = 20;
let snake = [];
let food = {};
let direction = 'RIGHT';
let score = 0;
let bestScore = Number(localStorage.getItem('bestScore')) || 0;
let gameInterval = null;
let paused = false;
let gameOver = false;
let gameOverPlayed = false;

const skins = [
  { head: '#00ff88', body: '#00e676' },
  { head: '#42a5f5', body: '#1e88e5' },
  { head: '#ff7043', body: '#ff5722' },
  { head: '#ab47bc', body: '#8e24aa' }
];
let currentSkin = 0;

skins.forEach((skin, index) => {
  const btn = document.createElement('div');
  btn.className = 'skin-btn';
  btn.style.background = skin.body;
  if (index === currentSkin) btn.classList.add('active');
  btn.onclick = () => {
    currentSkin = index;
    document.querySelectorAll('.skin-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  };
  skinMenu.appendChild(btn);
});

const eatSound = new Audio('https://assets.mixkit.co/active_storage/sfx/270/270-preview.mp3');
const pauseSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');
const gameOverSound = new Audio('https://assets.mixkit.co/active_storage/sfx/3005/3005-preview.mp3');

bestText.textContent = bestScore;

function spawnFood() {
  food = {
    x: Math.floor(Math.random() * (canvas.width / box)) * box,
    y: Math.floor(Math.random() * (canvas.height / box)) * box
  };
}

function initGame() {
  // unlock audio on user interaction (required by browsers)
  pauseSound.play().then(() => {
    pauseSound.pause();
    pauseSound.currentTime = 0;
  }).catch(() => {});

  clearInterval(gameInterval);
  snake = [{ x: 9 * box, y: 9 * box }];
  direction = 'RIGHT';
  score = 0;
  paused = false;
  gameOver = false;
  gameOverPlayed = false;
  scoreText.textContent = score;
  spawnFood();
  startBtn.textContent = 'Restart Game';
  gameInterval = setInterval(gameLoop, 120);
}

function collision(head, body) {
  return body.some(seg => seg.x === head.x && seg.y === head.y);
}

function drawGrid() {
  ctx.strokeStyle = '#2a2a2a';
  for (let i = 0; i <= canvas.width; i += box) {
    ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke();
  }
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawGrid();

  if (paused && !gameOver) {
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('PAUSED', canvas.width / 2, canvas.height / 2);
    return;
  }

  let head = { ...snake[0] };
  if (direction === 'LEFT') head.x -= box;
  if (direction === 'RIGHT') head.x += box;
  if (direction === 'UP') head.y -= box;
  if (direction === 'DOWN') head.y += box;

  if (
    head.x < 0 || head.y < 0 ||
    head.x >= canvas.width || head.y >= canvas.height ||
    collision(head, snake)
  ) {
    gameOver = true;
    if (!gameOverPlayed) {
      gameOverPlayed = true;
      gameOverSound.currentTime = 0;
      gameOverSound.play();
    }
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#ff5252';
    ctx.font = 'bold 32px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2);
    return;
  }

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    score++;
    scoreText.textContent = score;
    eatSound.currentTime = 0;
    eatSound.play();
    spawnFood();
  } else {
    snake.pop();
  }

  snake.forEach((seg, i) => {
    ctx.fillStyle = i === 0 ? skins[currentSkin].head : skins[currentSkin].body;
    ctx.fillRect(seg.x + 1, seg.y + 1, box - 2, box - 2);
  });

  ctx.fillStyle = '#ffeb3b';
  ctx.fillRect(food.x, food.y, box, box);
}

window.addEventListener('keydown', e => {
  const key = e.key.toLowerCase();

  if (['arrowup','arrowdown','arrowleft','arrowright','w','a','s','d',' '].includes(key)) {
    e.preventDefault();
  }

  if (key === ' ') {
    if (gameOver) {
      initGame();
    } else {
      paused = !paused;
      pauseSound.currentTime = 0;
      pauseSound.play();
    }
    return;
  }

  if (paused || gameOver) return;

  if ((key === 'arrowup' || key === 'w') && direction !== 'DOWN') direction = 'UP';
  if ((key === 'arrowdown' || key === 's') && direction !== 'UP') direction = 'DOWN';
  if ((key === 'arrowleft' || key === 'a') && direction !== 'RIGHT') direction = 'LEFT';
  if ((key === 'arrowright' || key === 'd') && direction !== 'LEFT') direction = 'RIGHT';
});

startBtn.onclick = initGame;

let deferredPrompt;
const installBtn = document.getElementById('installBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault(); // stop browser auto-popup
  deferredPrompt = e;
  installBtn.style.display = 'inline-block';
});

installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) return;

  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;

  if (outcome === 'accepted') {
    console.log('App installed');
  }

  deferredPrompt = null;
  installBtn.style.display = 'none';
});

</script>
</body>
</html>
